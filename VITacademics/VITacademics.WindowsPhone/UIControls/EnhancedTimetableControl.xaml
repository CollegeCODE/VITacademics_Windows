<UserControl
    x:Class="VITacademics.UIControls.EnhancedTimetableControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:VITacademics.UIControls"
    xmlns:helpers="using:VITacademics.Helpers"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignHeight="720"
    d:DesignWidth="420"
    RequestedTheme="Light">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="ms-appx:///Resources/PhoneResources.xaml"></ResourceDictionary>
                <ResourceDictionary>

                    <helpers:BoolToVisibilityConverter x:Key="boolToVisibilityConverter"></helpers:BoolToVisibilityConverter>
                    <helpers:NullableDateToStringConverter x:Key="dateConverter"></helpers:NullableDateToStringConverter>
                    <helpers:DateToTimeStringConverter x:Key="dateToTimeConverter"></helpers:DateToTimeStringConverter>
                    
                    <Style TargetType="ListView">
                        <Setter Property="ItemContainerStyle">
                            <Setter.Value>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="HorizontalContentAlignment"
                                            Value="Stretch"></Setter>
                                </Style>
                            </Setter.Value>
                        </Setter>
                    </Style>
                    
                    <DataTemplate x:Key="classNowDataTemplate">
                    </DataTemplate>
                    
                    <DataTemplate x:Key="classTodayDataTemplate">
                        <Grid Margin="0,0,0,17">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"></ColumnDefinition>
                                <ColumnDefinition Width="*"></ColumnDefinition>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"></RowDefinition>
                            </Grid.RowDefinitions>
                            <Border Grid.Column="0" Width="80" Height="80" Margin="0,0,10,0"
                                    Background="WhiteSmoke" BorderThickness="0,0,0,13"
                                    BorderBrush="{Binding AttendanceInfo.Status, Converter={StaticResource StatusToForegroundConverter}, FallbackValue='LightGray'}">
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <TextBlock Grid.Row="0" Text="{Binding SessionHours.Parent.Venue}"
                                               Style="{StaticResource LabelTextBlockStyle}" HorizontalAlignment="Center"></TextBlock>
                                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding SessionHours.Parent.Attendance.Percentage}" Style="{StaticResource LabelTextBlockStyle}"></TextBlock>
                                        <TextBlock Margin="2,0,0,0" Text="%" Style="{StaticResource LabelTextBlockStyle}"></TextBlock>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="{Binding SessionHours.Parent.Title}" Style="{StaticResource SingleItemHeaderStyle}"></TextBlock>
                                
                                <Grid Height="25">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition></ColumnDefinition>
                                        <ColumnDefinition></ColumnDefinition>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="{Binding SessionHours}" Style="{StaticResource SingleItemContentStyle}"
                                               Foreground="{ThemeResource PhoneForegroundBrush}"></TextBlock>
                                    <local:GoMissAttendanceInfo Grid.Column="1" HorizontalAlignment="Right" 
                                        DataContext="{Binding SessionHours.Parent.Attendance}"></local:GoMissAttendanceInfo>
                                </Grid>
                                </StackPanel>
                        </Grid>
                    </DataTemplate>
                    
                    <DataTemplate x:Key="classGeneralDataTemplate">
                        <Grid Margin="0,0,0,17">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"></ColumnDefinition>
                                <ColumnDefinition Width="*"></ColumnDefinition>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"></RowDefinition>
                            </Grid.RowDefinitions>
                            <Border Grid.Column="0" Width="80" Height="80" Margin="0,0,10,0"
                                    Background="WhiteSmoke" BorderThickness="0,0,0,13"
                                    BorderBrush="{Binding AttendanceInfo.Status, Converter={StaticResource StatusToForegroundConverter}, FallbackValue='LightGray'}">
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                            DataContext="{Binding SessionHours.Parent}">
                                    <TextBlock Text="{Binding CourseCode}" Style="{StaticResource LabelTextBlockStyle}"
                                               HorizontalAlignment="Center" TextAlignment="Center"></TextBlock>
                                    <TextBlock Text="{Binding Venue}" Style="{StaticResource LabelTextBlockStyle}"
                                               HorizontalAlignment="Center" TextAlignment="Center"></TextBlock>
                                </StackPanel>
                            </Border>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="{Binding SessionHours.Parent.Title}" Style="{StaticResource SingleItemHeaderStyle}"></TextBlock>
                                <TextBlock Text="{Binding SessionHours}" Style="{StaticResource SingleItemContentStyle}" Foreground="{ThemeResource PhoneForegroundBrush}"></TextBlock>
                            </StackPanel>
                        </Grid>
                        
                    </DataTemplate>

                    <helpers:ClassInfoTemplateSelector x:Key="classInfoTemplateSelector"
                                                       ClassGeneralTemplate="{StaticResource classGeneralDataTemplate}"
                                                       ClassNowTemplate="{StaticResource classTodayDataTemplate}"
                                                       ClassTodayTemplate="{StaticResource classTodayDataTemplate}"></helpers:ClassInfoTemplateSelector>
                    
                    <Style TargetType="PivotItem">
                        <Setter Property="ContentTemplate">
                            <Setter.Value>
                                <DataTemplate>
                                    <ScrollViewer>
                                        <StackPanel>
                                            <TextBlock Text="You have no classes today." Style="{ThemeResource GroupHeaderTextBlockStyle}"
                                                   Visibility="{Binding IsEmptyDay, Converter={StaticResource boolToVisibilityConverter}}"></TextBlock>

                                            <ListView ItemsSource="{Binding RegularClassesInfo}"
                                                  ItemTemplateSelector="{StaticResource classInfoTemplateSelector}"></ListView>

                                            <TextBlock Text="EXTRA CLASSES" Margin="0,20,0,0" Style="{ThemeResource TitleTextBlockStyle}"
                                                       Visibility="{Binding HadExtraClasses, Converter={StaticResource boolToVisibilityConverter}}"></TextBlock>

                                            <ListView ItemsSource="{Binding ExtraClassesInfo}" Margin="0,13,0,0">
                                                <ListView.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid Margin="0,0,0,10">
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition></RowDefinition>
                                                                <RowDefinition></RowDefinition>
                                                                <RowDefinition></RowDefinition>
                                                            </Grid.RowDefinitions>

                                                            <TextBlock Grid.Row="0" Text="{Binding Key.Title}"
                                                                       Style="{StaticResource SingleItemHeaderStyle}"></TextBlock>
                                                            <TextBlock Grid.Row="1" Text="{Binding Key.CourseCode}"
                                                                       Style="{StaticResource SingleItemContentStyle}"></TextBlock>
                                                            <TextBlock Grid.Row="1" Text="{Binding Key.Venue}"
                                                                       HorizontalAlignment="Right" Style="{StaticResource SingleItemContentStyle}"></TextBlock>
                                                            <TextBlock Grid.Row="2" Text="{Binding Value.Status}" Style="{StaticResource LabelTextBlockStyle}" TextLineBounds="TrimToBaseline"
                                                                       Foreground="{Binding Value.Status, Converter={StaticResource StatusToForegroundConverter}}"></TextBlock>
                                                        </Grid>
                                                    </DataTemplate>
                                                </ListView.ItemTemplate>
                                            </ListView>
                                        </StackPanel>
                                    </ScrollViewer>
                                </DataTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                    
                </ResourceDictionary>        
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"></RowDefinition>
            <RowDefinition Height="*"></RowDefinition>
        </Grid.RowDefinitions>
        <Pivot x:Name="rootPivot" Grid.Row="1" Margin="0,-15,0,0"
               Style="{StaticResource ContentPivotStyle}">
            <Pivot.TitleTemplate>
                <DataTemplate>
                    <TextBlock Visibility="Collapsed"></TextBlock>
                </DataTemplate>
            </Pivot.TitleTemplate>
        </Pivot>

        <Button Content="{Binding CurrentDate, Converter={StaticResource dateConverter}}" Background="WhiteSmoke"
                Foreground="{ThemeResource PhoneAccentBrush}" BorderBrush="Transparent" BorderThickness="0"
                x:Name="dateDisplayBlock" Click="Button_Click" Margin="7,0,0,0"></Button>
    </Grid>
    
</UserControl>
